<!doctype html>
<title>Fruitfacts Maintenance</title>
<style>
  body {
    text-align: center;
    padding: 150px;
  }

  h1 {
    font-size: 50px;
  }

  body {
    font: 20px Helvetica, sans-serif;
    color: #333;
  }

  article {
    display: block;
    text-align: left;
    width: 650px;
    margin: 0 auto;
  }

  a {
    color: #dc8100;
    text-decoration: none;
  }

  a:hover {
    color: #333;
    text-decoration: none;
  }
</style>

<body onload="runCount()">

</body>

<article>
  <h1><b>Fact:</b> this site is undergoing maintenance</h1>
  <div>
    <p>usually this is a database update that takes ~15 minutes</p>
    <p class="container_inner" id="display_div_id">
  </div>
  </p>
  </div>
</article>

<script>
  const start_time = "%UNIX_TIME_S%000"; // this gets set by the script that starts maintenance

  function msToTime(duration) {
    const hours = Math.floor(duration / (1000 * 60 * 60)),
      minutes = Math.floor((duration / (1000 * 60)) % 60),
      seconds = Math.floor((duration / 1000) % 60);

    let beginning = '';
    if (hours > 0) {
      beginning = String(hours) + ':';
    }

    return beginning + String(minutes).padStart(2, '0') + ':' + String(seconds).padStart(2, '0');
  }

  function runCount() {
    setInterval(function () {
      const now = Date.now();
      if(!isNaN(start_time) && now > start_time) {
        const time = msToTime(now - start_time);
        document.getElementById('display_div_id').innerHTML = `time since maintenance started: ${time}`;
      }
    }, 1000);
  }
</script>